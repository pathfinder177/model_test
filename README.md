# Пайплайн для тестирования модели:

## Описание репозитория test
1. Jenkinsfile
2. Readme.md
3. docker(directory)
    * Dockerfile
    * requirements.txt
    * test-model.sh
4. software: ПО для тестирования

## Triggers
Пайплайн триггерится:
1. Каждые 12 часов
2. Если за последние 4 часа было обновление в соответствующем репозитории

## Stages

### GLOBAL ENV VARS
1. Версия модели
2. Репозиторий
3. Ветка репозитория(клонируется во время сборки докер-контейнера)
4. Название билда докер-контейнера с зависимостями

### Build
1. Исполнение stage передается на агент, который собирает и пушит докер-образы в локальный репозиторий (предположим, что он существует)
2. На агент в папку test клонируется репозиторий test
3. На агент устанавливается nfs-common для временного монтирования шары с датасетом
4. Шара с датасетом монтируется в папку ./docker/dataset, dataset затем копируется в докер контейнер в процессе сборки Dockerfile
5. Dockerfile собирает image на основе python3:9 с моделью, dataset, ПО для тестирования (это поможет нам не выкачивать зависимости в рантайме), и установкой зависимостей из requirements.txt
6. Image пушится в локальный докер репозиторий

### Test
1. Исполнение stage передается на агент(ы), который запускает докер-контейнер(ы) с необходимым TARGET параллельно

### Post
1. Публикация сводного отчета с каждого таргета в директорию с отчетами